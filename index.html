<script>
  window.addEventListener("DOMContentLoaded", () => {
    const sdkStatus = document.getElementById("sdk-status");
    const messageOutput = document.getElementById("message-output");

    microsoftTeams.app.initialize().then(() => {
      sdkStatus.textContent = "âœ… Microsoft Teams SDK initialized.";

      microsoftTeams.app.getContext().then((context) => {
        // Try subEntityId from SDK (fallback if launched via subEntityId path)
        if (context.subEntityId) {
          messageOutput.textContent = "ğŸ“© Message (SDK): " + context.subEntityId;
          return;
        }

        // Otherwise try parsing the ?context= param manually
        const params = new URLSearchParams(window.location.search);
        const contextParam = params.get("context");

        if (contextParam) {
          try {
            const decoded = decodeURIComponent(contextParam);
            const contextObj = JSON.parse(decoded);
            const message = contextObj.subEntityId;
            messageOutput.textContent = message
              ? "ğŸ“© Message (query param): " + message
              : "â„¹ï¸ Context parsed, but no message.";
          } catch (e) {
            messageOutput.textContent = "âŒ Error parsing context JSON.";
          }
        } else {
          messageOutput.textContent = "â„¹ï¸ No message passed via SDK or URL.";
        }
      }).catch((err) => {
        messageOutput.textContent = "âŒ Failed to get context: " + err;
      });
    }).catch((err) => {
      sdkStatus.textContent = "âŒ SDK init failed: " + err;
    });
  });
</script>
