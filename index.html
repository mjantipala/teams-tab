<script>
  window.addEventListener("DOMContentLoaded", () => {
    const sdkStatus = document.getElementById("sdk-status");
    const messageOutput = document.getElementById("message-output");

    microsoftTeams.app.initialize().then(() => {
      sdkStatus.textContent = "✅ Teams SDK initialized.";

      microsoftTeams.app.getContext().then((context) => {
        const message = context.subEntityId;
        if (message) {
          messageOutput.textContent = "📩 Message from context: " + message;
        } else {
          // Fallback: try from URL query string (for debugging)
          const params = new URLSearchParams(window.location.search);
          const contextParam = params.get("context");
          if (contextParam) {
            try {
              const parsed = JSON.parse(decodeURIComponent(contextParam));
              messageOutput.textContent = parsed.subEntityId
                ? "📩 Message from URL: " + parsed.subEntityId
                : "ℹ️ Context exists but no subEntityId.";
            } catch {
              messageOutput.textContent = "❌ Failed to parse URL context.";
            }
          } else {
            messageOutput.textContent = "ℹ️ No message found in context or URL.";
          }
        }
      });
    }).catch((err) => {
      sdkStatus.textContent = "❌ SDK init failed: " + err;
    });
  });
</script>
